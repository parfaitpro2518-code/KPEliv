<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#0D0D0D">
<title>KpÃ©Liv â€” Livraison Togo</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=Noto+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --g1: #00E676;   /* vert vif */
  --g2: #00C853;   /* vert moyen */
  --g3: #1B5E20;   /* vert foncÃ© */
  --gl: #E8F5E9;   /* vert clair bg */
  --o1: #FF6D00;   /* orange */
  --o2: #FF9E40;   /* orange clair */
  --ol: #FFF3E0;   /* orange bg */
  --b1: #1565C0;   /* bleu */
  --bl: #E3F2FD;   /* bleu bg */
  --r1: #E53935;   /* rouge */
  --rl: #FFEBEE;   /* rouge bg */
  --y1: #F9A825;   /* jaune */
  --yl: #FFFDE7;   /* jaune bg */
  --ink: #0D0D0D;
  --ink2: #1F1F1F;
  --bg: #F2EFE9;
  --bg2: #E8E4DC;
  --card: #FFFFFF;
  --txt: #1A1A1A;
  --muted: #6B6B6B;
  --border: #DDD8CE;
  --radius: 16px;
  --shadow: 0 2px 16px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth;font-size:16px}
body{
  font-family:'Noto Sans',sans-serif;
  background:var(--bg);color:var(--txt);
  max-width:480px;margin:0 auto;
  min-height:100vh;position:relative;
  overflow-x:hidden;
}
h1,h2,h3,.num{font-family:'Outfit',sans-serif}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{display:none;min-height:100vh;padding-bottom:100px;animation:fadeIn .22s ease}
.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hdr{
  background:var(--ink);color:#fff;
  padding:15px 18px 12px;
  display:flex;align-items:center;gap:10px;
  position:sticky;top:0;z-index:200;
}
.hdr-back{
  background:none;border:none;color:#fff;
  font-size:26px;cursor:pointer;line-height:1;
  padding:0;width:34px;flex-shrink:0;
}
.logo{font-family:'Outfit',sans-serif;font-size:20px;font-weight:900;letter-spacing:-.5px}
.logo em{color:var(--g1);font-style:normal}
.hdr-title{font-family:'Outfit',sans-serif;font-size:17px;font-weight:700;flex:1}
.hdr-badge{
  background:var(--g1);color:var(--ink);
  border-radius:100px;padding:3px 10px;
  font-size:12px;font-weight:700;
  font-family:'Outfit',sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero{
  background:var(--ink);
  padding:0 0 0;
  position:relative;overflow:hidden;
}
.hero-inner{padding:36px 20px 28px;text-align:center}
.hero-tag{
  display:inline-block;
  background:rgba(0,230,118,.15);
  border:1px solid rgba(0,230,118,.3);
  color:var(--g1);
  border-radius:100px;padding:5px 14px;
  font-size:12px;font-weight:600;letter-spacing:.5px;
  margin-bottom:14px;
}
.hero h1{
  font-size:34px;font-weight:900;color:#fff;
  line-height:1.1;margin-bottom:10px;letter-spacing:-.5px;
}
.hero h1 span{color:var(--g1)}
.hero p{color:#ADADAD;font-size:14px;line-height:1.6}
.hero-deco{
  position:absolute;bottom:-30px;right:-30px;
  width:140px;height:140px;
  background:radial-gradient(circle,rgba(0,230,118,.12),transparent 70%);
  border-radius:50%;
}

/* STATS STRIP */
.stats-strip{
  background:var(--ink2);
  display:flex;border-top:1px solid #2A2A2A;
}
.stat-item{
  flex:1;padding:14px 8px;text-align:center;
  border-right:1px solid #2A2A2A;
}
.stat-item:last-child{border-right:none}
.stat-n{font-family:'Outfit',sans-serif;font-size:24px;font-weight:900;color:var(--g1)}
.stat-l{font-size:10px;color:#777;margin-top:2px;text-transform:uppercase;letter-spacing:.3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROLE CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.role-grid{padding:20px 16px;display:flex;flex-direction:column;gap:12px}
.role-card{
  background:var(--card);border-radius:20px;
  padding:22px 18px;
  display:flex;align-items:center;gap:16px;
  cursor:pointer;
  border:2px solid transparent;
  box-shadow:var(--shadow);
  transition:all .18s;
  position:relative;overflow:hidden;
}
.role-card::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  opacity:0;transition:.18s;
}
.role-card:active{transform:scale(.98)}
.role-card.merchant{border-color:var(--o1)}
.role-card.merchant::before{background:var(--ol)}
.role-card.driver{border-color:var(--g1)}
.role-card.driver::before{background:var(--gl)}
.role-card.tracker{border-color:var(--b1)}
.role-card.tracker::before{background:var(--bl)}
.role-card:active::before{opacity:.4}
.rc-icon{
  width:58px;height:58px;border-radius:16px;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;flex-shrink:0;position:relative;z-index:1;
}
.merchant .rc-icon{background:var(--ol)}
.driver   .rc-icon{background:var(--gl)}
.tracker  .rc-icon{background:var(--bl)}
.rc-info{flex:1;position:relative;z-index:1}
.rc-info h3{font-family:'Outfit',sans-serif;font-size:17px;font-weight:800;margin-bottom:3px}
.rc-info p{font-size:12px;color:var(--muted);line-height:1.4}
.rc-arr{font-size:24px;color:var(--muted);position:relative;z-index:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-wrap{padding:16px}
.form-card{
  background:var(--card);border-radius:20px;
  padding:22px 18px;
  box-shadow:var(--shadow);margin-bottom:12px;
}
.form-card-title{
  font-family:'Outfit',sans-serif;font-size:17px;font-weight:800;
  margin-bottom:18px;display:flex;align-items:center;gap:8px;
}
.form-card-title .ic{font-size:20px}

.field{margin-bottom:14px}
.field-label{
  display:block;font-size:11px;font-weight:600;
  color:var(--muted);text-transform:uppercase;letter-spacing:.6px;
  margin-bottom:6px;
}
.field-row{display:flex;gap:8px}
.field-row .field{flex:1;margin-bottom:0}

input[type=text],input[type=tel],input[type=number],input[type=url],select,textarea{
  width:100%;padding:13px 14px;
  border:1.5px solid var(--border);border-radius:12px;
  font-family:'Noto Sans',sans-serif;font-size:15px;
  background:var(--bg);color:var(--txt);outline:none;
  transition:border-color .15s,box-shadow .15s;
  appearance:none;
}
input:focus,select:focus,textarea:focus{
  border-color:var(--g2);
  box-shadow:0 0 0 3px rgba(0,200,83,.12);
}
textarea{resize:vertical;min-height:72px}
select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B6B6B' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}

.geo-btn{
  display:flex;align-items:center;gap:7px;
  margin-top:7px;
  background:none;border:1.5px solid var(--border);
  border-radius:10px;padding:9px 13px;
  font-size:13px;font-weight:600;color:var(--b1);
  cursor:pointer;width:100%;
  transition:.15s;
}
.geo-btn:active{background:var(--bl)}
.geo-hint{font-size:11px;color:var(--muted);margin-top:4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  width:100%;padding:16px;border:none;border-radius:14px;
  font-family:'Outfit',sans-serif;font-size:16px;font-weight:800;
  cursor:pointer;transition:all .15s;
  display:flex;align-items:center;justify-content:center;gap:8px;
  letter-spacing:-.2px;
}
.btn:active{transform:scale(.97)}
.btn-green {background:var(--g2);color:#fff}
.btn-green:active{background:var(--g3)}
.btn-orange{background:var(--o1);color:#fff}
.btn-blue  {background:var(--b1);color:#fff}
.btn-dark  {background:var(--ink);color:#fff}
.btn-ghost {background:transparent;border:1.5px solid var(--border);color:var(--muted)}
.btn-sm{
  padding:10px 14px;border:none;border-radius:10px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;
  cursor:pointer;transition:all .14s;
  display:inline-flex;align-items:center;gap:6px;
}
.btn-sm:active{transform:scale(.96)}
.bsm-green {background:var(--gl);color:var(--g3)}
.bsm-orange{background:var(--ol);color:#BF360C}
.bsm-blue  {background:var(--bl);color:var(--b1)}
.bsm-red   {background:var(--rl);color:var(--r1)}
.bsm-dark  {background:var(--ink);color:#fff}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge{
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 11px;border-radius:100px;
  font-size:11px;font-weight:700;letter-spacing:.2px;
  font-family:'Outfit',sans-serif;
}
.b-waiting   {background:var(--yl);color:#795500}
.b-accepted  {background:var(--bl);color:var(--b1)}
.b-delivering{background:var(--ol);color:#BF360C}
.b-done      {background:var(--gl);color:var(--g3)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DELIVERY CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card-list{padding:0 16px}
.dcard{
  background:var(--card);border-radius:18px;
  padding:16px;margin-bottom:12px;
  box-shadow:var(--shadow);
  animation:fadeIn .22s ease;
  position:relative;overflow:hidden;
}
.dcard-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px}
.dcard-biz{font-family:'Outfit',sans-serif;font-size:16px;font-weight:800}
.dcard-price{
  font-family:'Outfit',sans-serif;font-size:15px;font-weight:900;
  color:var(--o1);white-space:nowrap;margin-left:8px;
}
.dcard-id{font-size:11px;color:var(--muted);margin-bottom:8px}
.dcard-route{
  background:var(--bg);border-radius:10px;
  padding:10px 12px;margin-bottom:10px;
}
.route-line{
  display:flex;align-items:flex-start;gap:10px;
  font-size:13px;padding:3px 0;
}
.route-dot{
  width:10px;height:10px;border-radius:50%;
  flex-shrink:0;margin-top:2px;
}
.dot-from{background:var(--o1)}
.dot-to  {background:var(--g2)}
.route-line-text{color:var(--txt);line-height:1.4}
.route-line-sub{font-size:11px;color:var(--muted)}
.route-vline{width:1px;height:10px;background:var(--border);margin-left:4px}

.dcard-contacts{
  display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;
}
.contact-chip{
  background:var(--bg);border-radius:8px;
  padding:5px 10px;font-size:12px;color:var(--muted);
  display:flex;align-items:center;gap:5px;
}
.contact-chip strong{color:var(--txt);font-weight:600}

.dcard-actions{display:flex;flex-direction:column;gap:8px}
.dcard-actions-row{display:flex;gap:8px}
.dcard-actions-row .btn-sm{flex:1;justify-content:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACKER â€” TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.timeline{padding:4px 0}
.tl-step{display:flex;gap:12px;position:relative;padding:6px 0}
.tl-step:not(:last-child)::after{
  content:'';position:absolute;
  left:13px;top:30px;width:2px;height:calc(100% - 8px);
  background:var(--border);
}
.tl-step.done::after{background:var(--g2)}
.tl-dot{
  width:28px;height:28px;border-radius:50%;
  border:2px solid var(--border);background:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:12px;flex-shrink:0;
  position:relative;z-index:1;transition:.3s;
}
.tl-step.done    .tl-dot{border-color:var(--g2);background:var(--g2);color:#fff}
.tl-step.current .tl-dot{border-color:var(--o1);background:var(--o1);color:#fff;box-shadow:0 0 0 5px rgba(255,109,0,.15)}
.tl-step.pending .tl-dot{color:var(--muted)}
.tl-info{padding-top:4px}
.tl-label{font-size:13px;font-weight:600;color:var(--txt)}
.tl-step.pending .tl-label{color:var(--muted)}
.tl-time{font-size:11px;color:var(--muted);margin-top:1px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRIVER PROFILE CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-card{
  background:var(--ink);color:#fff;
  padding:18px;border-radius:18px;
  margin:16px;
  display:flex;align-items:center;gap:14px;
  box-shadow:0 4px 20px rgba(0,0,0,.2);
}
.profile-avatar{
  width:52px;height:52px;border-radius:50%;
  background:var(--g2);
  display:flex;align-items:center;justify-content:center;
  font-family:'Outfit',sans-serif;font-size:22px;font-weight:900;color:#fff;
  flex-shrink:0;
}
.profile-info{flex:1}
.profile-name{font-family:'Outfit',sans-serif;font-size:16px;font-weight:800;margin-bottom:2px}
.profile-sub{font-size:12px;color:#888}
.profile-status{
  padding:6px 12px;border-radius:100px;
  font-family:'Outfit',sans-serif;font-size:12px;font-weight:700;cursor:pointer;
  transition:.15s;border:none;
}
.ps-online{background:var(--g1);color:var(--ink)}
.ps-offline{background:#333;color:#777}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION HEADERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 16px 10px;
}
.sec-hdr h2{font-family:'Outfit',sans-serif;font-size:18px;font-weight:800}
.count-pill{
  background:var(--ink);color:var(--g1);
  border-radius:100px;padding:4px 12px;
  font-size:12px;font-weight:700;font-family:'Outfit',sans-serif;
}

/* TABS */
.tab-bar{
  display:flex;
  margin:0 16px 16px;
  background:var(--bg2);
  border-radius:12px;padding:4px;gap:4px;
}
.tab-btn{
  flex:1;padding:9px;border:none;border-radius:9px;
  font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;
  cursor:pointer;color:var(--muted);background:transparent;transition:.15s;
}
.tab-btn.active{background:var(--ink);color:var(--g1)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZONE TAGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.zone-tag{
  display:inline-flex;align-items:center;gap:4px;
  background:var(--gl);color:var(--g3);
  border-radius:8px;padding:4px 10px;
  font-size:12px;font-weight:600;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO ROWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-block{background:var(--bg);border-radius:12px;padding:14px 15px;margin-bottom:8px}
.info-block-lbl{font-size:10px;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.6px;margin-bottom:3px}
.info-block-val{font-family:'Outfit',sans-serif;font-size:16px;font-weight:800}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.6);z-index:300;
  align-items:flex-end;
}
.overlay.show{display:flex}
.sheet{
  background:var(--card);border-radius:24px 24px 0 0;
  padding:8px 22px 44px;width:100%;max-width:480px;
  animation:sheetUp .28s cubic-bezier(.34,1.56,.64,1);
  max-height:90vh;overflow-y:auto;
}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{
  width:40px;height:4px;background:var(--border);
  border-radius:100px;margin:12px auto 20px;
}
.sheet-title{font-family:'Outfit',sans-serif;font-size:21px;font-weight:900;margin-bottom:6px;text-align:center}
.sheet-sub{font-size:13px;color:var(--muted);text-align:center;margin-bottom:20px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast{
  position:fixed;bottom:28px;left:50%;
  transform:translateX(-50%) translateY(90px);
  background:var(--ink);color:#fff;
  padding:13px 22px;border-radius:100px;
  font-size:13px;font-weight:500;z-index:999;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);
  white-space:nowrap;pointer-events:none;
  box-shadow:0 4px 20px rgba(0,0,0,.3);
}
.toast.show{transform:translateX(-50%) translateY(0)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty{text-align:center;padding:50px 20px;color:var(--muted)}
.empty-ico{font-size:48px;margin-bottom:12px}
.empty p{font-size:14px;line-height:1.6}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIVIDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.divider{height:1px;background:var(--border);margin:16px 0}
.or-divider{
  display:flex;align-items:center;gap:10px;
  color:var(--muted);font-size:12px;margin:10px 0;
}
.or-divider::before,.or-divider::after{content:'';flex:1;height:1px;background:var(--border)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRIVER REGISTRATION GATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.reg-wrap{padding:16px}
.reg-card{
  background:var(--card);border-radius:20px;
  padding:24px 18px;box-shadow:var(--shadow);
}
.reg-card h2{font-family:'Outfit',sans-serif;font-size:19px;font-weight:800;margin-bottom:4px}
.reg-card p{font-size:13px;color:var(--muted);margin-bottom:20px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MERCHANT ORDER LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.my-order-card{
  background:var(--card);border-radius:18px;
  padding:16px;margin-bottom:12px;
  box-shadow:var(--shadow);
  border-left:4px solid var(--border);
}
.my-order-card.w-waiting   {border-color:var(--y1)}
.my-order-card.w-accepted  {border-color:var(--b1)}
.my-order-card.w-delivering{border-color:var(--o1)}
.my-order-card.w-done      {border-color:var(--g2)}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : ACCUEIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-home" class="page active">
  <div class="hdr">
    <span class="logo">KpÃ©<em>Liv</em></span>
    <div style="flex:1"></div>
    <span class="hdr-badge">ğŸ‡¹ğŸ‡¬ Togo</span>
  </div>
  <div class="hero">
    <div class="hero-inner">
      <div class="hero-tag">MVP Terrain Â· LomÃ©</div>
      <h1>La livraison<br><span>rapide & fiable</span><br>au Togo</h1>
      <p>Connectez vos clients en quelques secondes.<br>Simple. Rapide. Efficace.</p>
    </div>
    <div class="stats-strip">
      <div class="stat-item">
        <div class="stat-n" id="s-active">0</div>
        <div class="stat-l">En cours</div>
      </div>
      <div class="stat-item">
        <div class="stat-n" id="s-wait">0</div>
        <div class="stat-l">En attente</div>
      </div>
      <div class="stat-item">
        <div class="stat-n" id="s-done">0</div>
        <div class="stat-l">LivrÃ©es</div>
      </div>
    </div>
  </div>

  <div class="role-grid">
    <div class="role-card merchant" onclick="go('p-merchant-home')">
      <div class="rc-icon">ğŸª</div>
      <div class="rc-info">
        <h3>Je suis CommerÃ§ant</h3>
        <p>CrÃ©er une commande et trouver un livreur rapidement</p>
      </div>
      <span class="rc-arr">â€º</span>
    </div>
    <div class="role-card driver" onclick="go('p-driver-home')">
      <div class="rc-icon">ğŸ›µ</div>
      <div class="rc-info">
        <h3>Je suis Livreur</h3>
        <p>Voir les livraisons disponibles et gagner de l'argent</p>
      </div>
      <span class="rc-arr">â€º</span>
    </div>
    <div class="role-card tracker" onclick="go('p-tracker')">
      <div class="rc-icon">ğŸ“¦</div>
      <div class="rc-info">
        <h3>Suivre une commande</h3>
        <p>Consulter l'Ã©tat d'une livraison en temps rÃ©el</p>
      </div>
      <span class="rc-arr">â€º</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : ESPACE COMMERÃ‡ANT (HUB)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-merchant-home" class="page">
  <div class="hdr">
    <button class="hdr-back" onclick="go('p-home')">â€¹</button>
    <span class="hdr-title">Espace CommerÃ§ant</span>
  </div>
  <div class="role-grid" style="padding-top:20px">
    <div class="role-card merchant" onclick="go('p-merchant-create')">
      <div class="rc-icon">â•</div>
      <div class="rc-info">
        <h3>CrÃ©er une commande</h3>
        <p>Nouvelle demande de livraison</p>
      </div>
      <span class="rc-arr">â€º</span>
    </div>
    <div class="role-card tracker" onclick="renderMerchantOrders();go('p-merchant-orders')">
      <div class="rc-icon">ğŸ“‹</div>
      <div class="rc-info">
        <h3>Mes commandes</h3>
        <p>Suivre l'Ã©tat de vos livraisons</p>
      </div>
      <span class="rc-arr">â€º</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : CRÃ‰ER UNE COMMANDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-merchant-create" class="page">
  <div class="hdr">
    <button class="hdr-back" onclick="go('p-merchant-home')">â€¹</button>
    <span class="hdr-title">Nouvelle commande</span>
  </div>
  <div class="form-wrap">

    <!-- COMMERÃ‡ANT -->
    <div class="form-card">
      <div class="form-card-title"><span class="ic">ğŸª</span> Informations commerÃ§ant</div>
      <div class="field">
        <label class="field-label">Nom du commerce *</label>
        <input type="text" id="m-biz" placeholder="Ex : Boutique Akosua">
      </div>
      <div class="field">
        <label class="field-label">TÃ©lÃ©phone commerÃ§ant *</label>
        <input type="tel" id="m-tel" placeholder="+228 90 00 00 00">
      </div>
    </div>

    <!-- RÃ‰CUPÃ‰RATION -->
    <div class="form-card">
      <div class="form-card-title"><span class="ic">ğŸ“</span> Lieu de rÃ©cupÃ©ration</div>
      <div class="field">
        <label class="field-label">Adresse (texte) *</label>
        <textarea id="m-pickup-txt" placeholder="Ex : MarchÃ© Adawlato, cÃ´tÃ© pharmacie, LomÃ©"></textarea>
      </div>
      <div class="field">
        <label class="field-label">Lien Google Maps (optionnel)</label>
        <input type="url" id="m-pickup-map" placeholder="https://maps.google.com/...">
        <button class="geo-btn" onclick="getGeo('m-pickup-map','m-pickup-txt')">
          ğŸ“¡ Utiliser ma position actuelle
        </button>
        <div class="geo-hint">NÃ©cessite l'autorisation de localisation</div>
      </div>
    </div>

    <!-- CLIENT -->
    <div class="form-card">
      <div class="form-card-title"><span class="ic">ğŸ‘¤</span> Informations client</div>
      <div class="field">
        <label class="field-label">Nom du client *</label>
        <input type="text" id="m-client-name" placeholder="Ex : Amara Diallo">
      </div>
      <div class="field">
        <label class="field-label">TÃ©lÃ©phone client *</label>
        <input type="tel" id="m-client-tel" placeholder="+228 91 00 00 00">
      </div>
    </div>

    <!-- LIVRAISON -->
    <div class="form-card">
      <div class="form-card-title"><span class="ic">ğŸ</span> Adresse de livraison</div>
      <div class="field">
        <label class="field-label">Adresse (texte) *</label>
        <textarea id="m-delivery-txt" placeholder="Ex : Tokoin FÃ©au, derriÃ¨re la pharmacie, LomÃ©"></textarea>
      </div>
      <div class="field">
        <label class="field-label">Lien Google Maps client (optionnel)</label>
        <input type="url" id="m-delivery-map" placeholder="https://maps.google.com/...">
        <button class="geo-btn" onclick="getGeo('m-delivery-map','m-delivery-txt')">
          ğŸ“¡ Position actuelle du client
        </button>
      </div>
    </div>

    <!-- PRIX -->
    <div class="form-card">
      <div class="form-card-title"><span class="ic">ğŸ’°</span> Prix de livraison</div>
      <div class="field">
        <label class="field-label">Montant proposÃ© (FCFA) *</label>
        <input type="number" id="m-price" placeholder="Ex : 1500" min="0" step="50">
      </div>
      <div class="field">
        <label class="field-label">Notes pour le livreur (optionnel)</label>
        <textarea id="m-notes" placeholder="Fragile, appeler avant d'arriver..."></textarea>
      </div>
    </div>

    <button class="btn btn-orange" onclick="createOrder()" style="margin-bottom:8px">
      â• CrÃ©er la commande
    </button>
    <button class="btn btn-ghost" onclick="go('p-merchant-home')">Annuler</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : MES COMMANDES (MARCHAND)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-merchant-orders" class="page">
  <div class="hdr">
    <button class="hdr-back" onclick="go('p-merchant-home')">â€¹</button>
    <span class="hdr-title">Mes commandes</span>
    <button class="hdr-back" onclick="renderMerchantOrders()" style="font-size:18px;width:auto;padding:0 0 0 8px" title="RafraÃ®chir">ğŸ”„</button>
  </div>
  <div class="sec-hdr">
    <h2>Toutes mes commandes</h2>
    <span class="count-pill" id="mc-count">0</span>
  </div>
  <div class="card-list" id="merchant-orders-list"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : ESPACE LIVREUR (HUB)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-driver-home" class="page">
  <div class="hdr">
    <button class="hdr-back" onclick="go('p-home')">â€¹</button>
    <span class="hdr-title">Espace Livreur</span>
  </div>
  <!-- DRIVER NOT REGISTERED -->
  <div id="driver-reg-panel">
    <div class="reg-wrap">
      <div class="reg-card">
        <h2>ğŸ‘‹ Bienvenue livreur !</h2>
        <p>CrÃ©ez votre profil pour commencer Ã  recevoir des livraisons</p>
        <div class="field">
          <label class="field-label">Votre prÃ©nom / nom *</label>
          <input type="text" id="d-name" placeholder="Ex : Kossi Agbeko">
        </div>
        <div class="field">
          <label class="field-label">TÃ©lÃ©phone *</label>
          <input type="tel" id="d-tel" placeholder="+228 90 00 00 00">
        </div>
        <div class="field">
          <label class="field-label">Zone principale de travail *</label>
          <select id="d-zone">
            <option value="">SÃ©lectionner une zone</option>
            <option>AgoÃ¨</option>
            <option>AdidogomÃ©</option>
            <option>BÃ¨</option>
            <option>Tokoin</option>
            <option>NyÃ©konakpoÃ¨</option>
            <option>KodjoviakopÃ©</option>
            <option>HanoukopÃ©</option>
            <option>Baguida</option>
            <option>Aflao (frontiÃ¨re)</option>
            <option>Totsi</option>
            <option>LomÃ© centre</option>
            <option>Autre zone</option>
          </select>
        </div>
        <div class="field">
          <label class="field-label">Type de vÃ©hicule</label>
          <select id="d-vehicle">
            <option value="ğŸ›µ Moto">ğŸ›µ Moto</option>
            <option value="ğŸš² VÃ©lo">ğŸš² VÃ©lo</option>
            <option value="ğŸš— Voiture">ğŸš— Voiture</option>
            <option value="ğŸš¶ Ã€ pied">ğŸš¶ Ã€ pied</option>
          </select>
        </div>
        <button class="btn btn-green" onclick="registerDriver()" style="margin-top:8px">
          âœ… CrÃ©er mon profil
        </button>
      </div>
    </div>
  </div>

  <!-- DRIVER REGISTERED -->
  <div id="driver-main-panel" style="display:none">
    <div class="profile-card">
      <div class="profile-avatar" id="d-avatar">K</div>
      <div class="profile-info">
        <div class="profile-name" id="d-profile-name">Kossi</div>
        <div class="profile-sub" id="d-profile-sub">ğŸ›µ Moto Â· AgoÃ¨</div>
      </div>
      <button class="profile-status ps-offline" id="d-status-btn" onclick="toggleDriverStatus()">
        Hors ligne
      </button>
    </div>

    <div class="tab-bar">
      <button class="tab-btn active" id="tab-avail" onclick="switchDriverTab('avail')">Disponibles</button>
      <button class="tab-btn" id="tab-mine" onclick="switchDriverTab('mine')">Mes livraisons</button>
    </div>

    <!-- AVAILABLE ORDERS -->
    <div id="driver-avail-panel">
      <div class="sec-hdr">
        <h2>Commandes disponibles</h2>
        <span class="count-pill" id="avail-count">0</span>
      </div>
      <div class="card-list" id="avail-list"></div>
    </div>

    <!-- MY ORDERS -->
    <div id="driver-mine-panel" style="display:none">
      <div class="sec-hdr">
        <h2>Mes livraisons</h2>
        <span class="count-pill" id="mine-count">0</span>
      </div>
      <div class="card-list" id="mine-list"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGE : SUIVI GLOBAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="p-tracker" class="page">
  <div class="hdr">
    <button class="hdr-back" onclick="go('p-home')">â€¹</button>
    <span class="hdr-title">Suivi des livraisons</span>
    <button class="hdr-back" onclick="renderTracker()" style="font-size:18px;width:auto;padding:0 0 0 8px" title="RafraÃ®chir">ğŸ”„</button>
  </div>
  <div class="sec-hdr">
    <h2>Toutes les commandes</h2>
    <span class="count-pill" id="tr-count">0</span>
  </div>
  <div class="card-list" id="tracker-list"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL : CONFIRMATION ACCEPTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="modal-accept" onclick="closeModal('modal-accept',event)">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div style="text-align:center;font-size:40px;margin-bottom:10px">ğŸ‰</div>
    <div class="sheet-title">Livraison acceptÃ©e !</div>
    <div class="sheet-sub">Contactez le marchand pour confirmer le retrait</div>
    <div id="modal-accept-body"></div>
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:4px">
      <a id="modal-call-merchant" href="#" class="btn btn-dark">ğŸ“ Appeler le marchand</a>
      <a id="modal-call-client"   href="#" class="btn btn-green">ğŸ“ Appeler le client</a>
      <button class="btn btn-ghost" onclick="closeModal('modal-accept',null)">Fermer</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODAL : DÃ‰TAIL COMMANDE SUIVI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="modal-detail" onclick="closeModal('modal-detail',event)">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title" id="modal-detail-title">Commande</div>
    <div class="sheet-sub" id="modal-detail-sub"></div>
    <div id="modal-detail-body"></div>
    <button class="btn btn-ghost" onclick="closeModal('modal-detail',null)" style="margin-top:8px">Fermer</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ORDERS_KEY  = 'kpeliv_orders_v1';
const DRIVER_KEY  = 'kpeliv_driver_v1';
const DONE_KEY    = 'kpeliv_done_v1';

const STATUTS = [
  { key:'waiting',    label:'En attente de livreur', icon:'â³', cls:'b-waiting'    },
  { key:'accepted',   label:'Livreur trouvÃ©',         icon:'ğŸ›µ', cls:'b-accepted'   },
  { key:'delivering', label:'En livraison',            icon:'ğŸš€', cls:'b-delivering' },
  { key:'done',       label:'LivrÃ© âœ“',                 icon:'âœ…', cls:'b-done'       },
];

const MSGS = {
  waiting:    'En attente d\'un livreur disponibleâ€¦',
  accepted:   'Un livreur a acceptÃ© votre commande.',
  delivering: 'Le livreur est en route vers le client !',
  done:       'Commande livrÃ©e avec succÃ¨s ğŸ‰',
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STORAGE HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const getOrders  = ()=>{ try{return JSON.parse(localStorage.getItem(ORDERS_KEY))||[]}catch{return[]} };
const saveOrders = a=>localStorage.setItem(ORDERS_KEY, JSON.stringify(a));
const getDriver  = ()=>{ try{return JSON.parse(localStorage.getItem(DRIVER_KEY))||null}catch{return null} };
const saveDriver = d=>localStorage.setItem(DRIVER_KEY, JSON.stringify(d));
const getDone    = ()=>parseInt(localStorage.getItem(DONE_KEY)||'0');
const incDone    = ()=>localStorage.setItem(DONE_KEY, getDone()+1);
const genId      = ()=>'#'+Math.floor(1000+Math.random()*9000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function go(pageId){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(pageId).classList.add('active');
  window.scrollTo(0,0);
  // Hooks
  if(pageId==='p-home')         updateHomeStats();
  if(pageId==='p-driver-home')  initDriverPage();
  if(pageId==='p-tracker')      renderTracker();
  if(pageId==='p-merchant-home')updateHomeStats();
}

function updateHomeStats(){
  const all = getOrders();
  document.getElementById('s-active').textContent = all.filter(o=>o.status!=='done').length;
  document.getElementById('s-wait').textContent   = all.filter(o=>o.status==='waiting').length;
  document.getElementById('s-done').textContent   = getDone();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GÃ‰OLOCALISATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getGeo(mapFieldId, txtFieldId){
  if(!navigator.geolocation){ toast('âŒ GÃ©olocalisation non supportÃ©e'); return; }
  toast('ğŸ“¡ RÃ©cupÃ©ration de la positionâ€¦');
  navigator.geolocation.getCurrentPosition(
    pos=>{
      const lat = pos.coords.latitude.toFixed(6);
      const lng = pos.coords.longitude.toFixed(6);
      const url = `https://www.google.com/maps?q=${lat},${lng}`;
      document.getElementById(mapFieldId).value = url;
      document.getElementById(txtFieldId).value = `Position GPS : ${lat}, ${lng}`;
      toast('âœ… Position rÃ©cupÃ©rÃ©e !');
    },
    err=>{ toast('âŒ Impossible d\'obtenir la position'); }
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CRÃ‰ER UNE COMMANDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function createOrder(){
  const biz       = val('m-biz');
  const tel       = val('m-tel');
  const pickupTxt = val('m-pickup-txt');
  const pickupMap = val('m-pickup-map');
  const clientN   = val('m-client-name');
  const clientT   = val('m-client-tel');
  const delivTxt  = val('m-delivery-txt');
  const delivMap  = val('m-delivery-map');
  const price     = val('m-price');
  const notes     = val('m-notes');

  // Validation
  const required = [[biz,'Nom du commerce'],[tel,'TÃ©lÃ©phone commerÃ§ant'],[pickupTxt,'Adresse de rÃ©cupÃ©ration'],
                    [clientN,'Nom du client'],[clientT,'TÃ©lÃ©phone client'],[delivTxt,'Adresse de livraison'],[price,'Prix']];
  for(const [v,lbl] of required){
    if(!v){ toast(`âš ï¸ Manque : ${lbl}`); return; }
  }

  const orders = getOrders();
  const order = {
    id: genId(),
    ts: Date.now(),
    merchantBiz: biz,
    merchantTel: tel,
    pickupTxt, pickupMap,
    clientName: clientN,
    clientTel: clientT,
    deliveryTxt: delivTxt,
    deliveryMap: delivMap,
    price, notes,
    status: 'waiting',
    driverName:'',
    driverTel:'',
    timeline:[{status:'waiting', time:Date.now()}]
  };
  orders.unshift(order);
  saveOrders(orders);

  // Clear form
  ['m-biz','m-tel','m-pickup-txt','m-pickup-map','m-client-name','m-client-tel','m-delivery-txt','m-delivery-map','m-price','m-notes']
    .forEach(id=>{ const el=document.getElementById(id); if(el)el.value=''; });

  toast('âœ… Commande crÃ©Ã©e ! ID : '+order.id);
  setTimeout(()=>go('p-merchant-home'),1200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MES COMMANDES (MARCHAND)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderMerchantOrders(){
  const all = getOrders();
  document.getElementById('mc-count').textContent = all.length;
  const el = document.getElementById('merchant-orders-list');
  if(!all.length){
    el.innerHTML = emptyState('ğŸ“­','Aucune commande crÃ©Ã©e pour le moment.');
    return;
  }
  el.innerHTML = all.map(o=>{
    const st = statusObj(o.status);
    const tlHtml = buildTimeline(o);
    return `<div class="my-order-card w-${o.status}">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px">
        <span style="font-family:Outfit,sans-serif;font-size:16px;font-weight:800">${esc(o.merchantBiz)}</span>
        <span style="font-family:Outfit,sans-serif;font-size:14px;font-weight:900;color:var(--o1)">${fmt(o.price)} FCFA</span>
      </div>
      <div style="font-size:11px;color:var(--muted);margin-bottom:8px">Commande ${o.id} Â· ${timeAgo(o.ts)}</div>
      <span class="badge ${st.cls}">${st.icon} ${st.label}</span>
      ${o.driverName?`<div style="margin-top:8px;font-size:13px">ğŸ›µ Livreur : <strong>${esc(o.driverName)}</strong> Â· <a href="tel:${o.driverTel}" style="color:var(--g3)">${o.driverTel}</a></div>`:''}
      ${MSGS[o.status]?`<div style="font-size:12px;color:var(--muted);margin-top:6px">ğŸ’¬ ${MSGS[o.status]}</div>`:''}
      <div style="margin-top:12px">${tlHtml}</div>
      ${o.deliveryMap?`<a href="${o.deliveryMap}" target="_blank" class="btn-sm bsm-blue" style="margin-top:10px;width:100%;justify-content:center">ğŸ—ºï¸ Voir destination sur Maps</a>`:''}
    </div>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFIL LIVREUR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function registerDriver(){
  const name    = val('d-name');
  const tel     = val('d-tel');
  const zone    = val('d-zone');
  const vehicle = document.getElementById('d-vehicle').value;
  if(!name||!tel||!zone){ toast('âš ï¸ Tous les champs sont requis'); return; }
  const driver = { name, tel, zone, vehicle, online:false };
  saveDriver(driver);
  toast('âœ… Profil crÃ©Ã© !');
  initDriverPage();
}

function initDriverPage(){
  const driver = getDriver();
  if(!driver){
    document.getElementById('driver-reg-panel').style.display='block';
    document.getElementById('driver-main-panel').style.display='none';
    return;
  }
  document.getElementById('driver-reg-panel').style.display='none';
  document.getElementById('driver-main-panel').style.display='block';
  document.getElementById('d-avatar').textContent = driver.name[0].toUpperCase();
  document.getElementById('d-profile-name').textContent = driver.name;
  document.getElementById('d-profile-sub').textContent  = `${driver.vehicle} Â· ${driver.zone}`;
  updateDriverStatusBtn(driver);
  switchDriverTab('avail');
}

function toggleDriverStatus(){
  const driver = getDriver(); if(!driver)return;
  driver.online = !driver.online;
  saveDriver(driver);
  updateDriverStatusBtn(driver);
  renderAvailOrders();
  toast(driver.online ? 'ğŸŸ¢ Vous Ãªtes maintenant en ligne !' : 'âš« Vous Ãªtes hors ligne');
}

function updateDriverStatusBtn(driver){
  const btn = document.getElementById('d-status-btn');
  btn.textContent = driver.online ? 'ğŸŸ¢ En ligne' : 'âš« Hors ligne';
  btn.className = 'profile-status ' + (driver.online ? 'ps-online' : 'ps-offline');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ONGLETS LIVREUR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchDriverTab(tab){
  document.getElementById('tab-avail').classList.toggle('active', tab==='avail');
  document.getElementById('tab-mine').classList.toggle('active', tab==='mine');
  document.getElementById('driver-avail-panel').style.display = tab==='avail'?'block':'none';
  document.getElementById('driver-mine-panel').style.display  = tab==='mine'?'block':'none';
  if(tab==='avail') renderAvailOrders();
  if(tab==='mine')  renderMyOrders();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMMANDES DISPONIBLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAvailOrders(){
  const driver = getDriver();
  const el = document.getElementById('avail-list');
  if(!driver||!driver.online){
    el.innerHTML = `<div class="empty"><div class="empty-ico">âš«</div><p>Passez en ligne pour voir les commandes disponibles</p></div>`;
    document.getElementById('avail-count').textContent = '0';
    return;
  }
  const all = getOrders().filter(o=>o.status==='waiting');
  document.getElementById('avail-count').textContent = all.length;
  if(!all.length){
    el.innerHTML = emptyState('ğŸ‰','Aucune commande disponible.<br>Revenez dans quelques instants.');
    return;
  }
  el.innerHTML = all.map(o=> orderCard(o,'driver-avail')).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MES LIVRAISONS (LIVREUR)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderMyOrders(){
  const driver = getDriver(); if(!driver)return;
  const all = getOrders().filter(o=>o.driverTel===driver.tel && o.status!=='waiting');
  document.getElementById('mine-count').textContent = all.length;
  const el = document.getElementById('mine-list');
  if(!all.length){
    el.innerHTML = emptyState('ğŸ“‹','Vous n\'avez pas encore de livraisons acceptÃ©es.');
    return;
  }
  el.innerHTML = all.map(o=> orderCard(o,'driver-mine')).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD BUILDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function orderCard(o, context){
  const st = statusObj(o.status);
  const pickupMap  = o.pickupMap  || buildMapUrl(o.pickupTxt);
  const delivMap   = o.deliveryMap|| buildMapUrl(o.deliveryTxt);
  const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(o.deliveryTxt)}`;

  let actions = '';

  if(context==='driver-avail'){
    actions = `
      <div class="dcard-actions">
        <div class="dcard-actions-row">
          <button class="btn-sm bsm-green" onclick="acceptOrder('${o.id}')">âœ… Accepter</button>
          <a class="btn-sm bsm-blue" href="${navUrl}" target="_blank">ğŸ—ºï¸ Google Maps</a>
        </div>
      </div>`;
  }
  if(context==='driver-mine'){
    const nextBtns = driverNextBtn(o.id, o.status);
    actions = `
      <div class="dcard-actions">
        <div class="dcard-actions-row">
          <a class="btn-sm bsm-blue" href="tel:${o.merchantTel}">ğŸ“ Marchand</a>
          <a class="btn-sm bsm-green" href="tel:${o.clientTel}">ğŸ“ Client</a>
          <a class="btn-sm bsm-blue" href="${navUrl}" target="_blank">ğŸ—ºï¸ Nav.</a>
        </div>
        ${nextBtns}
      </div>`;
  }
  if(context==='tracker'){
    actions = `
      <div class="dcard-actions">
        <button class="btn-sm bsm-blue" onclick="showDetailModal('${o.id}')">ğŸ” Voir dÃ©tails</button>
        ${delivMap?`<a class="btn-sm bsm-green" href="${delivMap}" target="_blank">ğŸ—ºï¸ Maps</a>`:''}
      </div>`;
  }

  return `<div class="dcard" id="dcard-${o.id.slice(1)}">
    <div class="dcard-top">
      <span class="dcard-biz">${esc(o.merchantBiz)}</span>
      <span class="dcard-price">${fmt(o.price)} FCFA</span>
    </div>
    <div class="dcard-id">Commande ${o.id} Â· ${timeAgo(o.ts)}</div>
    <div><span class="badge ${st.cls}" style="margin-bottom:10px">${st.icon} ${st.label}</span></div>
    <div class="dcard-route">
      <div class="route-line">
        <div class="route-dot dot-from"></div>
        <div>
          <div class="route-line-text">${esc(o.pickupTxt)}</div>
          <div class="route-line-sub">Lieu de rÃ©cupÃ©ration</div>
        </div>
      </div>
      <div class="route-vline" style="margin-left:4px;margin-top:4px;margin-bottom:4px"></div>
      <div class="route-line">
        <div class="route-dot dot-to"></div>
        <div>
          <div class="route-line-text">${esc(o.deliveryTxt)}</div>
          <div class="route-line-sub">Lieu de livraison Â· <strong>${esc(o.clientName)}</strong></div>
        </div>
      </div>
    </div>
    <div class="dcard-contacts">
      <div class="contact-chip">ğŸ“ <strong>${esc(o.merchantTel)}</strong></div>
      <div class="contact-chip">ğŸ‘¤ <strong>${esc(o.clientTel)}</strong></div>
    </div>
    ${o.notes?`<div style="font-size:12px;color:var(--muted);margin-bottom:10px">ğŸ“ ${esc(o.notes)}</div>`:''}
    ${actions}
  </div>`;
}

function driverNextBtn(id, status){
  const map = {
    accepted:   { next:'delivering', label:'ğŸš€ Je suis en livraison', cls:'bsm-orange' },
    delivering: { next:'done',       label:'âœ… Commande livrÃ©e',      cls:'bsm-green'  },
  };
  const btn = map[status];
  if(!btn) return '';
  return `<button class="btn-sm ${btn.cls}" style="width:100%;justify-content:center;margin-top:4px" onclick="updateStatus('${id}','${btn.next}')">${btn.label}</button>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCEPTER UNE COMMANDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function acceptOrder(id){
  const driver = getDriver(); if(!driver)return;
  let orders = getOrders();
  const idx = orders.findIndex(o=>o.id===id);
  if(idx===-1){ toast('Commande introuvable'); return; }
  if(orders[idx].status!=='waiting'){ toast('âŒ DÃ©jÃ  prise !'); renderAvailOrders(); return; }

  orders[idx].status = 'accepted';
  orders[idx].driverName = driver.name;
  orders[idx].driverTel  = driver.tel;
  orders[idx].timeline.push({status:'accepted',time:Date.now()});
  saveOrders(orders);

  // Animate out
  const card = document.getElementById('dcard-'+id.slice(1));
  if(card){ card.style.transition='.2s'; card.style.opacity='0'; card.style.transform='scale(.95)'; }
  setTimeout(()=>{
    renderAvailOrders();
    showAcceptModal(orders[idx]);
  }, card?220:0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   METTRE Ã€ JOUR STATUT (LIVREUR)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStatus(id, newStatus){
  let orders = getOrders();
  const idx = orders.findIndex(o=>o.id===id);
  if(idx===-1) return;
  orders[idx].status = newStatus;
  orders[idx].timeline.push({status:newStatus,time:Date.now()});
  if(newStatus==='done') incDone();
  saveOrders(orders);
  renderMyOrders();
  const msgs = {delivering:'ğŸš€ En route !',done:'ğŸ‰ Livraison complÃ©tÃ©e !'};
  toast(msgs[newStatus]||'Statut mis Ã  jour');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderTracker(){
  const all = getOrders();
  document.getElementById('tr-count').textContent = all.length;
  const el = document.getElementById('tracker-list');
  if(!all.length){ el.innerHTML=emptyState('ğŸ“­','Aucune commande enregistrÃ©e.'); return; }
  el.innerHTML = all.map(o=> orderCard(o,'tracker')).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL ACCEPTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showAcceptModal(o){
  document.getElementById('modal-accept-body').innerHTML = `
    <div class="info-block"><div class="info-block-lbl">Commerce</div><div class="info-block-val">${esc(o.merchantBiz)}</div></div>
    <div class="info-block"><div class="info-block-lbl">RÃ©cupÃ©ration</div><div class="info-block-val" style="font-size:14px">${esc(o.pickupTxt)}</div></div>
    <div class="info-block"><div class="info-block-lbl">Livraison â†’ ${esc(o.clientName)}</div><div class="info-block-val" style="font-size:14px">${esc(o.deliveryTxt)}</div></div>
    <div class="info-block"><div class="info-block-lbl">Prix</div><div class="info-block-val" style="color:var(--o1)">${fmt(o.price)} FCFA</div></div>
  `;
  document.getElementById('modal-call-merchant').href = 'tel:'+o.merchantTel;
  document.getElementById('modal-call-client').href   = 'tel:'+o.clientTel;
  document.getElementById('modal-accept').classList.add('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL DÃ‰TAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showDetailModal(id){
  const o = getOrders().find(x=>x.id===id); if(!o)return;
  const st = statusObj(o.status);
  document.getElementById('modal-detail-title').textContent = `Commande ${o.id}`;
  document.getElementById('modal-detail-sub').textContent   = `${esc(o.merchantBiz)} Â· ${timeAgo(o.ts)}`;
  document.getElementById('modal-detail-body').innerHTML = `
    <span class="badge ${st.cls}">${st.icon} ${st.label}</span>
    <div style="margin:12px 0">${buildTimeline(o)}</div>
    <div class="info-block"><div class="info-block-lbl">RÃ©cupÃ©ration</div><div class="info-block-val" style="font-size:14px">${esc(o.pickupTxt)}</div></div>
    <div class="info-block"><div class="info-block-lbl">Livraison â†’ ${esc(o.clientName)}</div><div class="info-block-val" style="font-size:14px">${esc(o.deliveryTxt)}</div></div>
    <div class="info-block"><div class="info-block-lbl">Prix</div><div class="info-block-val" style="color:var(--o1)">${fmt(o.price)} FCFA</div></div>
    ${o.driverName?`<div class="info-block"><div class="info-block-lbl">Livreur</div><div class="info-block-val">${esc(o.driverName)} Â· ${o.driverTel}</div></div>`:''}
    ${o.notes?`<div class="info-block"><div class="info-block-lbl">Notes</div><div class="info-block-val" style="font-size:13px;font-weight:500">${esc(o.notes)}</div></div>`:''}
    ${MSGS[o.status]?`<div style="background:var(--bl);border-radius:12px;padding:12px;font-size:13px;color:var(--b1);margin-top:4px">ğŸ’¬ ${MSGS[o.status]}</div>`:''}
    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
      <a href="tel:${o.merchantTel}" class="btn-sm bsm-dark">ğŸ“ Marchand</a>
      <a href="tel:${o.clientTel}"   class="btn-sm bsm-green">ğŸ“ Client</a>
      ${o.deliveryMap?`<a href="${o.deliveryMap}" target="_blank" class="btn-sm bsm-blue">ğŸ—ºï¸ Maps</a>`:''}
    </div>
  `;
  document.getElementById('modal-detail').classList.add('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIMELINE BUILDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildTimeline(o){
  const cur = statusIdx(o.status);
  return `<div class="timeline">`+STATUTS.map((s,i)=>{
    let cls='pending';
    if(i<cur) cls='done';
    if(i===cur) cls='current';
    const tl = o.timeline.find(t=>t.status===s.key);
    const dotContent = cls==='done'?'âœ“': (cls==='current'?s.icon:'â—‹');
    return `<div class="tl-step ${cls}">
      <div class="tl-dot">${dotContent}</div>
      <div class="tl-info">
        <div class="tl-label">${s.label}</div>
        ${tl?`<div class="tl-time">${timeStr(tl.time)}</div>`:''}
      </div>
    </div>`;
  }).join('')+`</div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function closeModal(id, e){
  if(e===null||e.target.classList.contains('overlay'))
    document.getElementById(id).classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function val(id){ return (document.getElementById(id)||{}).value?.trim()||'' }

function statusObj(key){ return STATUTS.find(s=>s.key===key)||STATUTS[0] }
function statusIdx(key){ return STATUTS.findIndex(s=>s.key===key) }

function fmt(n){ return Number(n).toLocaleString('fr-FR') }

function esc(str){
  const d=document.createElement('div');
  d.appendChild(document.createTextNode(str||''));
  return d.innerHTML;
}

function buildMapUrl(addr){
  if(!addr) return '';
  return `https://www.google.com/maps/search/${encodeURIComponent(addr)}`;
}

function timeAgo(ts){
  const s=Math.floor((Date.now()-ts)/1000);
  if(s<60) return 'Ã  l\'instant';
  const m=Math.floor(s/60); if(m<60) return `il y a ${m} min`;
  const h=Math.floor(m/60); if(h<24) return `il y a ${h}h`;
  return `il y a ${Math.floor(h/24)}j`;
}

function timeStr(ts){
  return new Date(ts).toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
}

function emptyState(ico,txt){
  return `<div class="empty"><div class="empty-ico">${ico}</div><p>${txt}</p></div>`;
}

let _toast;
function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(_toast);
  _toast=setTimeout(()=>t.classList.remove('show'),2800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
updateHomeStats();
</script>
</body>
</html>
